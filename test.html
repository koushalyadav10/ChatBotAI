<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Queue Management System with AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6bff;
            --primary-light: #6a85ff;
            --secondary: #00c853;
            --danger: #ff4444;
            --warning: #ffbb33;
            --light: #f8f9fa;
            --dark: #2d3748;
            --darker: #1a202c;
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --chat-bg: #ffffff;
            --user-msg: #4a6bff;
            --bot-msg: #f1f3f6;
            --text-dark: #2d3748;
            --text-light: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            background-size: cover;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            border: 1px solid var(--glass-border);
            animation: fadeIn 0.8s ease-out;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(to right, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        h2, h3 {
            margin-bottom: 15px;
            color: var(--text-light);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            flex-grow: 1;
        }
        
        .panel {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border: 1px solid var(--glass-border);
            color: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.2);
        }
        
        /* Token Generation Form Styles */
        .token-form {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        select option {
            background-color: var(--primary);
            color: white;
        }
        
        button {
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-light);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #e53935;
        }
        
        .btn-success {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #00b248;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background-color: #ffaa00;
        }
        
        .token-display {
            text-align: center;
            padding: 30px;
            margin-top: 20px;
            border: 2px dashed var(--glass-border);
            border-radius: 16px;
            display: none;
            background-color: rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }
        
        .token-number {
            font-size: 4rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin: 10px 0;
        }
        
        .wait-time {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 15px;
        }
        
        /* Display Screen Styles */
        .display-screen {
            background-color: rgba(0, 0, 0, 0.3);
            color: #fff;
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .current-number {
            font-size: 6rem;
            font-weight: bold;
            color: var(--warning);
            margin: 30px 0;
            text-shadow: 0 4px 20px rgba(251, 188, 5, 0.4);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .counter-info {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .counter-box {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .counter-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .counter-name {
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .counter-number {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .counter-staff {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }
        
        .queue-list {
            margin-top: 25px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        
        .queue-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .queue-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .queue-item:last-child {
            border-bottom: none;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            margin-top: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            margin-right: 8px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .tab.active {
            background-color: rgba(255, 255, 255, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: -1px;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 25px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 12px 12px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .counter-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-card {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: white;
        }
        
        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 25px;
            background-color: var(--secondary);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s forwards, fadeOut 0.5s 4.5s forwards;
            transform: translateX(100%);
            opacity: 0;
        }
        
        @keyframes slideIn {
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        /* Chat Interface Styles */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            height: 550px;
            background-color: var(--chat-bg);
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(120%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }
        
        .chat-container.open {
            transform: translateY(0);
            opacity: 1;
        }
        
        .chat-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .chat-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-header h3 i {
            font-size: 1.1rem;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .chat-close:hover {
            transform: rotate(90deg);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--chat-bg);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background-color: var(--user-msg);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
            box-shadow: 0 2px 8px rgba(74, 107, 255, 0.3);
        }
        
        .bot-message {
            background-color: var(--bot-msg);
            color: var(--text-dark);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .chat-input-container {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            color:rgb(68, 59, 46)
        }
        
        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 107, 255, 0.2);
        }
        
        .chat-submit {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 10px rgba(74, 107, 255, 0.3);
        }
        
        .chat-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 107, 255, 0.4);
        }
        
        .chat-submit:active {
            transform: translateY(0);
        }
        
        .chat-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(74, 107, 255, 0.4);
            z-index: 999;
            transition: all 0.3s ease;
        }
        
        .chat-toggle:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 15px 40px rgba(74, 107, 255, 0.5);
        }
        
        .chat-toggle i {
            font-size: 1.8rem;
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: flex;
            padding: 12px 16px;
            background-color: var(--bot-msg);
            border-radius: 18px;
            margin-bottom: 15px;
            width: fit-content;
            border-bottom-left-radius: 5px;
            gap: 6px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #a0aec0;
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-5px); opacity: 1; }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .current-number {
                font-size: 4rem;
            }
            
            .token-number {
                font-size: 3rem;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .panel {
                padding: 20px;
            }
            
            .counter-controls, .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .counter-info {
                flex-direction: column;
            }
            
            .current-number {
                font-size: 3rem;
            }
            
            .token-number {
                font-size: 2.5rem;
            }
            
            .chat-container {
                width: 100%;
                height: 70vh;
                bottom: 0;
                right: 0;
                border-radius: 20px 20px 0 0;
            }
            
            .chat-toggle {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Smart Queue Management System</h1>
            <p>AI-powered queue management with real-time assistance</p>
        </header>
        
        <div class="main-grid">
            <!-- Left Panel - Token Generation -->
            <div class="left-panel">
                <div class="panel">
                    <h2><i class="fas fa-ticket-alt"></i> Get Queue Token</h2>
                    <form id="tokenForm" class="token-form">
                        <div class="form-group">
                            <label for="serviceType"><i class="fas fa-list-alt"></i> Service Type</label>
                            <select id="serviceType" required>
                                <option value="">Select a service</option>
                                <option value="account">Account Services</option>
                                <option value="loan">Loan Applications</option>
                                <option value="card">Card Services</option>
                                <option value="general">General Inquiry</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="customerName"><i class="fas fa-user"></i> Your Name</label>
                            <input type="text" id="customerName" placeholder="Enter your name" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone"><i class="fas fa-phone"></i> Phone Number (optional)</label>
                            <input type="tel" id="customerPhone" placeholder="For notifications">
                        </div>
                        <button type="submit" class="btn-success">
                            <i class="fas fa-qrcode"></i> Generate Token
                        </button>
                    </form>
                    
                    <div id="tokenDisplay" class="token-display">
                        <h3>Your Token Number</h3>
                        <div id="generatedToken" class="token-number">A101</div>
                        <div id="estimatedWait" class="wait-time">Estimated wait time: 15 minutes</div>
                        <button id="saveTokenBtn" class="btn-warning" style="margin-top: 20px;">
                            <i class="fas fa-mobile-alt"></i> Save to Phone
                        </button>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><i class="fas fa-info-circle"></i> Queue Information</h2>
                    <div id="queueStats">
                        <p>Current queue status:</p>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <div class="stat-label">Total Waiting</div>
                                <div id="totalWaiting" class="stat-value">24</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Avg. Wait Time</div>
                                <div id="avgWaitTime" class="stat-value">15m</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Your Position</div>
                                <div id="yourPosition" class="stat-value">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Display and Admin -->
            <div class="right-panel">
                <div class="panel display-screen">
                    <h2><i class="fas fa-desktop"></i> Now Serving</h2>
                    <div id="currentNumber" class="current-number">A101</div>
                    <div class="counter-info">
                        <div class="counter-box">
                            <div class="counter-name">Counter 1</div>
                            <div id="counter1" class="counter-number">A102</div>
                            <div class="counter-staff">Attendant: Mohan</div>
                        </div>
                        <div class="counter-box">
                            <div class="counter-name">Counter 2</div>
                            <div id="counter2" class="counter-number">B205</div>
                            <div class="counter-staff">Attendant: Chandan</div>
                        </div>
                        <div class="counter-box">
              
                            <div class="counter-name">Counter 3</div>
                            <div id="counter3" class="counter-number">C301</div>
                            <div class="counter-staff">Attendant: Priyashu</div>
                        </div>
                    </div>
                    
                    <div class="queue-list">
                        <h3>Upcoming Tokens</h3>
                        <div id="upcomingList">
                            <div class="queue-item">
                                <span>A102</span>
                                <span>Account Services</span>
                            </div>
                            <div class="queue-item">
                                <span>B205</span>
                                <span>Loan Applications</span>
                            </div>
                            <div class="queue-item">
                                <span>C301</span>
                                <span>Card Services</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel admin-panel">
                    <h2><i class="fas fa-cogs"></i> Counter Management</h2>
                    <div class="tabs">
                        <div class="tab active" data-tab="counter1">Counter 1 (Mohan)</div>
                        <div class="tab" data-tab="counter2">Counter 2 (Chandan)</div>
                        <div class="tab" data-tab="counter3">Counter 3 (Priyashu)</div>
                    </div>
                    
                    <div id="counter1Content" class="tab-content active">
                        <h3>Counter 1 Controls - Mohan</h3>
                        <div class="counter-controls">
                            <button class="btn-success call-next-btn" data-counter="1">
                                <i class="fas fa-bell"></i> Call Next
                            </button>
                            <button class="btn-warning recall-btn" data-counter="1">
                                <i class="fas fa-redo"></i> Recall Current
                            </button>
                            <button class="btn-danger pause-btn" data-counter="1">
                                <i class="fas fa-pause"></i> Pause Counter
                            </button>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="counter1Service">Service Type</label>
                            <select id="counter1Service" class="counter-service">
                                <option value="account">Account Services</option>
                                <option value="loan">Loan Applications</option>
                                <option value="card">Card Services</option>
                                <option value="general">General Inquiry</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="counter2Content" class="tab-content">
                        <h3>Counter 2 Controls - Chandan</h3>
                        <div class="counter-controls">
                            <button class="btn-success call-next-btn" data-counter="2">
                                <i class="fas fa-bell"></i> Call Next
                            </button>
                            <button class="btn-warning recall-btn" data-counter="2">
                                <i class="fas fa-redo"></i> Recall Current
                            </button>
                            <button class="btn-danger pause-btn" data-counter="2">
                                <i class="fas fa-pause"></i> Pause Counter
                            </button>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="counter2Service">Service Type</label>
                            <select id="counter2Service" class="counter-service">
                                <option value="account">Account Services</option>
                                <option value="loan">Loan Applications</option>
                                <option value="card">Card Services</option>
                                <option value="general">General Inquiry</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="counter3Content" class="tab-content">
                        <h3>Counter 3 Controls - Priyanshu</h3>
                        <div class="counter-controls">
                            <button class="btn-success call-next-btn" data-counter="3">
                                <i class="fas fa-bell"></i> Call Next
                            </button>
                            <button class="btn-warning recall-btn" data-counter="3">
                                <i class="fas fa-redo"></i> Recall Current
                            </button>
                            <button class="btn-danger pause-btn" data-counter="3">
                                <i class="fas fa-pause"></i> Pause Counter
                            </button>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="counter3Service">Service Type</label>
                            <select id="counter3Service" class="counter-service">
                                <option value="account">Account Services</option>
                                <option value="loan">Loan Applications</option>
                                <option value="card">Card Services</option>
                                <option value="general">General Inquiry</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification">
        <span id="notificationText">Your token A101 is being served at Counter 1</span>
    </div>
    
    <!-- AI Chat Interface -->
    <div class="chat-toggle" id="chatToggle">
        <i class="fas fa-robot"></i>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="chat-header" id="chatHeader">
            <h3><i class="fas fa-robot"></i> Queue Assistant</h3>
            <button class="chat-close" id="chatClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be inserted here -->
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask about your queue status...">
            <button class="chat-submit" id="chatSubmit">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <script>
        // Queue System Data
        const queues = {
            account: ['A101', 'A102', 'A103', 'A104'],
            loan: ['B201', 'B202', 'B203'],
            card: ['C301', 'C302'],
            general: ['G401', 'G402', 'G403']
        };
        
        const counters = {
            1: { current: 'A101', service: 'account', paused: false, staff: 'Mohan' },
            2: { current: 'B205', service: 'loan', paused: false, staff: 'Chandan' },
            3: { current: 'C301', service: 'card', paused: false, staff: 'Priyanshu' }
        };
        
        let currentToken = null;
        let currentCustomerName = null;
        let audioContext = null;
        let conversationHistory = [];
        
        // Initialize with system message about the queue system
        conversationHistory.push({
            role: "system",
            content: "You are a helpful queue assistant for a service center. " +
                     "The center has counters for Account Services, Loan Applications, " +
                     "Card Services, and General Inquiry. Help users with their queue " +
                     "status and provide friendly conversation while they wait."
        });
    
        // DOM Elements
        const tokenForm = document.getElementById('tokenForm');
        const tokenDisplay = document.getElementById('tokenDisplay');
        const generatedToken = document.getElementById('generatedToken');
        const estimatedWait = document.getElementById('estimatedWait');
        const currentNumber = document.getElementById('currentNumber');
        const counter1Display = document.getElementById('counter1');
        const counter2Display = document.getElementById('counter2');
        const counter3Display = document.getElementById('counter3');
        const upcomingList = document.getElementById('upcomingList');
        const totalWaiting = document.getElementById('totalWaiting');
        const avgWaitTime = document.getElementById('avgWaitTime');
        const yourPosition = document.getElementById('yourPosition');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        // Chat elements
        const chatToggle = document.getElementById('chatToggle');
        const chatContainer = document.getElementById('chatContainer');
        const chatHeader = document.getElementById('chatHeader');
        const chatClose = document.getElementById('chatClose');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const chatSubmit = document.getElementById('chatSubmit');
        
        // Configuration - Replace with your backend endpoint
        const API_ENDPOINT = "https://your-backend-service.com/api/chat";
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplays();
            setupEventListeners();
            simulateQueueMovement();
            initializeChat();
        });
        
        function setupEventListeners() {
            // Token generation form
            tokenForm.addEventListener('submit', function(e) {
                e.preventDefault();
                generateToken();
            });
            
            // Save token button
            document.getElementById('saveTokenBtn').addEventListener('click', function() {
                if (currentToken) {
                    alert(`Token ${currentToken} saved to your device. You'll be notified when it's your turn.`);
                }
            });
    
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}Content`).classList.add('active');
                });
            });
            
            // Counter controls
            document.querySelectorAll('.call-next-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const counterNum = this.getAttribute('data-counter');
                    callNextToken(counterNum);
                });
            });
            
            document.querySelectorAll('.recall-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const counterNum = this.getAttribute('data-counter');
                    recallToken(counterNum);
                });
            });
            
            document.querySelectorAll('.pause-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const counterNum = this.getAttribute('data-counter');
                    togglePauseCounter(counterNum);
                });
            });
            
            // Counter service type changes
            document.querySelectorAll('.counter-service').forEach(select => {
                select.addEventListener('change', function() {
                    const counterNum = this.id.replace('counter', '').replace('Service', '');
                    counters[counterNum].service = this.value;
                    updateDisplays();
                });
            });
        }
        
        function generateToken() {
            const serviceType = document.getElementById('serviceType').value;
            const customerName = document.getElementById('customerName').value;
            
            if (!serviceType || !customerName) {
                alert('Please select a service type and enter your name');
                return;
            }
            
            // Generate token
            const prefix = serviceType === 'account' ? 'A' : 
                           serviceType === 'loan' ? 'B' : 
                           serviceType === 'card' ? 'C' : 'G';
                           
            const lastNumber = queues[serviceType].length > 0 ? 
                parseInt(queues[serviceType][queues[serviceType].length - 1].substring(1)) : 0;
                
            const newToken = prefix + (lastNumber + 101).toString();
            queues[serviceType].push(newToken);
            currentToken = newToken;
            currentCustomerName = customerName;
            
            // Calculate position and estimated wait time
            const position = queues[serviceType].indexOf(newToken);
            const waitTime = position * 5;
            
            // Display the token
            generatedToken.textContent = newToken;
            estimatedWait.textContent = `Estimated wait time: ${waitTime} minutes`;
            yourPosition.textContent = position + 1;
            tokenDisplay.style.display = 'block';
            
            // Update displays
            updateDisplays();
            
            // Scroll to token display
            tokenDisplay.scrollIntoView({ behavior: 'smooth' });
            
            // Show notification
            showNotification(`Your token ${newToken} has been generated. Position in queue: ${position + 1}`);
            
            // Add to chat
            addBotMessage(`Your token ${newToken} has been generated for ${serviceType} service. You're position ${position + 1} in the queue with estimated wait time of ${waitTime} minutes.`);
        }
        
        function callNextToken(counterNum) {
            const counter = counters[counterNum];
            if (counter.paused) {
                showNotification(`Counter ${counterNum} is paused. Please resume first.`);
                return;
            }
            
            const serviceType = counter.service;
            if (queues[serviceType].length === 0) {
                showNotification(`No more tokens in ${serviceType} queue`);
                return;
            }
            
            // Get the next token
            const nextToken = queues[serviceType].shift();
            counter.current = nextToken;
            
            // Find customer name for this token
            const customerName = currentToken === nextToken ? currentCustomerName : "Customer";
            
            // Create announcement message
            const announcement = `Token number ${nextToken}, ${customerName}, please proceed to Counter ${counterNum}. Thank you.`;
            
            // Play the announcement
            playAnnouncement(announcement);
            
            // Update displays
            updateDisplays();
            
            // Play notification sound
            playNotificationSound();
            
            // Show visual notification
            showNotification(announcement);
            
            // If this was the user's token, update their position
            if (currentToken === nextToken) {
                yourPosition.textContent = '0 - Being served now';
                addBotMessage(`Your token ${nextToken} is now being served at Counter ${counterNum} with ${counter.staff}! Please proceed to the counter.`);
            } else if (currentToken && queues[serviceType].includes(currentToken)) {
                yourPosition.textContent = queues[serviceType].indexOf(currentToken) + 1;
                addBotMessage(`The queue has moved. You're now position ${queues[serviceType].indexOf(currentToken) + 1} in the queue.`);
            }
        }
        
        function recallToken(counterNum) {
            const counter = counters[counterNum];
            if (!counter.current) return;
            
            const announcement = `Token number ${counter.current}, please proceed to Counter ${counterNum}. Thank you.`;
            playAnnouncement(announcement);
            showNotification(announcement);
        }
        
        function togglePauseCounter(counterNum) {
            counters[counterNum].paused = !counters[counterNum].paused;
            const btn = document.querySelector(`.pause-btn[data-counter="${counterNum}"]`);
            
            if (counters[counterNum].paused) {
                btn.textContent = 'Resume Counter';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-success');
                showNotification(`Counter ${counterNum} (${counters[counterNum].staff}) paused`);
                addBotMessage(`Counter ${counterNum} with ${counters[counterNum].staff} has been paused.`);
            } else {
                btn.textContent = 'Pause Counter';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-danger');
                showNotification(`Counter ${counterNum} (${counters[counterNum].staff}) resumed`);
                addBotMessage(`Counter ${counterNum} with ${counters[counterNum].staff} has been resumed.`);
            }
        }
        
        function updateDisplays() {
            // Update main display
            currentNumber.textContent = counters[1].current || '---';
            
            // Update counter displays
            counter1Display.textContent = counters[1].current;
            counter2Display.textContent = counters[2].current;
            counter3Display.textContent = counters[3].current;
            
            // Update upcoming list
            upcomingList.innerHTML = '';
            
            // Get the next 3 tokens from each queue
            const upcomingTokens = [];
            for (const service in queues) {
                const serviceName = service === 'account' ? 'Account Services' :
                                    service === 'loan' ? 'Loan Applications' :
                                    service === 'card' ? 'Card Services' : 'General Inquiry';
                
                queues[service].slice(0, 3).forEach(token => {
                    upcomingTokens.push({ token, service: serviceName });
                });
            }
            
            // Display them
            upcomingTokens.slice(0, 5).forEach(item => {
                const div = document.createElement('div');
                div.className = 'queue-item';
                div.innerHTML = `<span>${item.token}</span><span>${item.service}</span>`;
                upcomingList.appendChild(div);
            });
            
            // Update stats
            let total = 0;
            for (const service in queues) {
                total += queues[service].length;
            }
            totalWaiting.textContent = total;
            
            // Update counter service types in admin panel
            document.getElementById('counter1Service').value = counters[1].service;
            document.getElementById('counter2Service').value = counters[2].service;
            document.getElementById('counter3Service').value = counters[3].service;
        }
        
        function showNotification(message) {
            notificationText.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        function playNotificationSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.5;
                
                oscillator.start();
                
                // Create a simple beep pattern
                gainNode.gain.exponentialRampToValueAtTime(0.5, audioContext.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.error('Audio playback error:', e);
            }
        }
        
        function playAnnouncement(message) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const speech = new SpeechSynthesisUtterance();
                speech.text = message;
                speech.volume = 1;
                speech.rate = 0.9;
                speech.pitch = 1;
                
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const femaleVoice = voices.find(v => v.name.includes('Female'));
                    speech.voice = femaleVoice || voices[0];
                }
                
                window.speechSynthesis.speak(speech);
            } else {
                playNotificationSound();
                showNotification(message);
            }
        }
        
        // Simulate queue movement for demo purposes
        function simulateQueueMovement() {
            setInterval(() => {
                const counterNum = Math.floor(Math.random() * 3) + 1;
                if (!counters[counterNum].paused && Math.random() > 0.7) {
                    callNextToken(counterNum);
                }
            }, 10000);
        }
        
        /* Chat Interface Functions */
       /* Chat Interface Functions */
function initializeChat() {
    // Toggle chat visibility
    chatToggle.addEventListener('click', function() {
        chatContainer.classList.toggle('open');
        if (chatContainer.classList.contains('open')) {
            chatInput.focus();
            if (chatMessages.children.length === 0) {
                addBotMessage("Hello! I'm your Queue Assistant. How can I help you with your queue status today?");
                addBotMessage("You can ask me things like:\n- \"When is my turn?\"\n- \"Who is at counter 2?\"\n- \"What's my position in the queue?\"\n- \"Tell me a joke to pass time\"\n- \"What's the current time?\"");
            }
        }
    });
    
    // Handle header click to toggle chat
    chatHeader.addEventListener('click', function(e) {
        if (e.target === chatHeader || e.target.tagName === 'H3') {
            chatContainer.classList.toggle('open');
            if (chatContainer.classList.contains('open')) {
                chatInput.focus();
            }
        }
    });
    
    // Handle close button
    chatClose.addEventListener('click', function(e) {
        e.stopPropagation();
        chatContainer.classList.remove('open');
    });
    
    // Handle chat input
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
    
    chatSubmit.addEventListener('click', sendMessage);
}

async function sendMessage() {
    const message = chatInput.value.trim();
    if (message === '') return;
    
    addUserMessage(message);
    chatInput.value = '';
    
    showTypingIndicator();
    
    try {
        const response = await generateAIResponse(message);
        addBotMessage(response);
    } catch (error) {
        console.error('Error generating response:', error);
        addBotMessage("I'm having trouble responding right now. Please try again later.");
    } finally {
        removeTypingIndicator();
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}

function addUserMessage(message) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message user-message';
    msgDiv.textContent = message;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addBotMessage(message) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message bot-message';
    
    // Handle line breaks and basic formatting
    const formattedMessage = message
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\n/g, '<br>');
    
    msgDiv.innerHTML = formattedMessage;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showTypingIndicator() {
    removeTypingIndicator();
    
    const typingDiv = document.createElement('div');
    typingDiv.className = 'typing-indicator';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    `;
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function removeTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

function getQueueContext() {
    return {
        currentToken: currentToken,
        customerName: currentCustomerName,
        counters: counters,
        queues: {
            account: queues.account.length,
            loan: queues.loan.length,
            card: queues.card.length,
            general: queues.general.length
        },
        currentTime: new Date().toLocaleTimeString(),
        date: new Date().toLocaleDateString()
    };
}


/* Enhanced Chatbot Functions */
function generateAIResponse(message) {
    const lowerMsg = message.toLowerCase().trim();
    const context = getQueueContext();
    const customerName = context.customerName || 'there';
    const currentToken = context.currentToken;
    
    // Handle empty or very short messages
    if (lowerMsg.length < 2) {
        return "Could you please provide more details about your question?";
    }

    // Check for greeting
    if (/^(hi|hello|hey|greetings|good\s(morning|afternoon|evening))/i.test(lowerMsg)) {
        return `Hello ${customerName}! I'm your Queue Assistant. How can I help you today?`;
    }

    // Check for queue position
    if (/(position|my turn|when|how long|wait|status|where am i|queue)/.test(lowerMsg)) {
        if (!currentToken) {
            return "You haven't generated a token yet. Please get a token first from the token generation section.";
        }

        const prefix = currentToken.charAt(0);
        const serviceType = prefix === 'A' ? 'account' :
                          prefix === 'B' ? 'loan' :
                          prefix === 'C' ? 'card' : 'general';
        const serviceName = serviceType === 'account' ? 'Account Services' :
                          serviceType === 'loan' ? 'Loan Applications' :
                          serviceType === 'card' ? 'Card Services' : 'General Inquiry';

        const position = queues[serviceType].indexOf(currentToken);
        if (position === -1) {
            for (const counterNum in counters) {
                if (counters[counterNum].current === currentToken) {
                    return `Your token ${currentToken} is currently being served at Counter ${counterNum} with ${counters[counterNum].staff}! Please proceed to the counter.`;
                }
            }
            return "Your token doesn't appear to be in the queue anymore. It may have been served already.";
        }

        const waitTime = (position + 1) * 5;
        let response = `Hello ${customerName}, here's your queue status:\n\n`;
        response += `- Token: ${currentToken}\n`;
        response += `- Service: ${serviceName}\n`;
        response += `- Position in queue: ${position + 1}\n`;
        response += `- Estimated wait time: ${waitTime} minutes\n\n`;

        // Add counter information
        response += `Current counters serving ${serviceName}:\n`;
        let countersServing = false;
        for (const counterNum in counters) {
            if (counters[counterNum].service === serviceType && !counters[counterNum].paused) {
                response += `- Counter ${counterNum} (${counters[counterNum].staff}): Serving ${counters[counterNum].current || 'none'}\n`;
                countersServing = true;
            }
        }

        if (!countersServing) {
            response += `- No counters currently serving ${serviceName}`;
        }

        return response;
    }

    // Check for counter status
    if (/(counter|status|serving|who is at)/.test(lowerMsg)) {
        // Check for specific counter query
        const counterMatch = lowerMsg.match(/counter (\d)/i);
        if (counterMatch) {
            const counterNum = counterMatch[1];
            if (counters[counterNum]) {
                const counter = counters[counterNum];
                const status = counter.paused ? ' (PAUSED)' : '';
                const serviceName = counter.service === 'account' ? 'Account Services' :
                                  counter.service === 'loan' ? 'Loan Applications' :
                                  counter.service === 'card' ? 'Card Services' : 'General Inquiry';
                
                return `Counter ${counterNum} Details${status}:\n\n` +
                       `- Currently serving: ${counter.current || 'None'}\n` +
                       `- Service type: ${serviceName}\n` +
                       `- Staff: ${counter.staff}\n` +
                       `- Status: ${counter.paused ? 'Paused' : 'Active'}`;
            }
            return `I couldn't find information about Counter ${counterNum}.`;
        }

        // General counter status request
        let response = "Current Status of All Counters:\n\n";
        for (const counterNum in counters) {
            const counter = counters[counterNum];
            const status = counter.paused ? ' (PAUSED)' : '';
            const serviceName = counter.service === 'account' ? 'Account Services' :
                              counter.service === 'loan' ? 'Loan Applications' :
                              counter.service === 'card' ? 'Card Services' : 'General Inquiry';
            
            response += `Counter ${counterNum}${status}:\n` +
                        `- Serving: ${counter.current || 'None'}\n` +
                        `- Service: ${serviceName}\n` +
                        `- Staff: ${counter.staff}\n\n`;
        }
        return response;
    }

    // Handle entertainment requests
    if (/(joke|funny|make me laugh)/.test(lowerMsg)) {
        const jokes = [
            "Why don't scientists trust atoms? Because they make up everything!",
            "Did you hear about the mathematician who's afraid of negative numbers? He'll stop at nothing to avoid them!",
            "Why don't queues ever get angry? Because they know how to wait their turn!",
            "What do you call a fake noodle? An impasta!",
            "How does a penguin build its house? Igloos it together!"
        ];
        return jokes[Math.floor(Math.random() * jokes.length)];
    }

    if (/(general knowledge|quiz|trivia|fact)/.test(lowerMsg)) {
        const facts = [
            "The Great Wall of China is the longest man-made structure in the world.",
            "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old!",
            "A crocodile cannot stick its tongue out.",
            "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes."
        ];
        return "Here's an interesting fact:\n\n" + facts[Math.floor(Math.random() * facts.length)];
    }

    if (/(bored|time pass|entertain me|what to do)/.test(lowerMsg)) {
        const activities = [
            "Try counting backwards from 100 by 7s!",
            "Let's play a word game - name a country for every letter of the alphabet!",
            "Think of 5 things you can see, 4 you can touch, 3 you can hear, 2 you can smell, and 1 you can taste.",
            "Try to name all the US states (or your country's provinces) in 1 minute!"
        ];
        return "While you wait, here's an activity:\n\n" + activities[Math.floor(Math.random() * activities.length)];
    }

    // Handle help request
    if (/(help|what can you do|options)/.test(lowerMsg)) {
        return "I can help you with:\n\n" +
               "**Queue Information:**\n" +
               "- Check your position\n" +
               "- Get wait times\n" +
               "- View counter status\n" +
               "- Check service types\n\n" +
               "**Entertainment:**\n" +
               "- Tell you a joke\n" +
               "- Share facts\n" +
               "- Suggest activities\n\n" +
               "Just ask me anything!";
    }

    // Handle time/date requests
    if (/(time|what time|current time)/.test(lowerMsg)) {
        return `The current time is ${new Date().toLocaleTimeString()}.`;
    }

    if (/(date|today's date|what date)/.test(lowerMsg)) {
        return `Today's date is ${new Date().toLocaleDateString()}.`;
    }

    // Handle customer name requests
    if (/(my name|who am i|customer name)/.test(lowerMsg)) {
        if (context.customerName) {
            return `Our records show your name as ${context.customerName}.`;
        }
        return "I don't have your name on record. Did you enter your name when generating your token?";
    }

    // Default response for unrecognized queries
    return `I'm not sure I understand. Here are some things I can help with:
- Your queue position
- Counter status
- Estimated wait times
- Fun activities while waiting

You can say things like:
- "What's my position?"
- "Tell me about counter 1"
- "Tell me a joke"
- "What can I do while waiting?"`;
}

async function generateAIResponse(message) {
    // Add user message to history
    conversationHistory.push({
        role: "user",
        content: message
    });
    
    try {
        // First check for simple local responses
        const localResponse = checkForLocalResponse(message);
        if (localResponse) return localResponse;
        
        // Call API for more complex responses
        const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                messages: conversationHistory,
                context: getQueueContext()
            })
        });
        
        if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        const aiResponse = data.response;
        
        // Add AI response to history
        conversationHistory.push({
            role: "assistant",
            content: aiResponse
        });
        
        return aiResponse;
        
    } catch (error) {
        console.error("API Error:", error);
        return generateEnhancedLocalResponse(message);
    }
}

function checkForLocalResponse(message) {
    const lowerMsg = message.toLowerCase();
    
    // Simple greetings
    if (/hello|hi|hey/.test(lowerMsg)) {
        return "Hello! I'm your Queue Assistant. How can I help you today?";
    }
    
    // Thank you
    if (/thank|thanks|appreciate/.test(lowerMsg)) {
        return "You're welcome! Is there anything else I can help with?";
    }
    
    // Current time
    if (/time|what time|current time/.test(lowerMsg)) {
        return `The current time is ${new Date().toLocaleTimeString()}.`;
    }
    
    // Current date
    if (/date|today's date|what date/.test(lowerMsg)) {
        return `Today's date is ${new Date().toLocaleDateString()}.`;
    }
    
    return null;
}

function generateEnhancedLocalResponse(message) {
    const lowerMsg = message.toLowerCase();
    const context = getQueueContext();
    
    // Check for queue position inquiries
    if (/position|my turn|when|how long|wait|status|where am i/.test(lowerMsg)) {
        if (!currentToken) {
            return "You haven't generated a token yet. Please get a token first from the token generation section.";
        }
        
        // Find which queue the token is in
        let serviceType = '';
        const prefix = currentToken.charAt(0);
        if (prefix === 'A') serviceType = 'account';
        else if (prefix === 'B') serviceType = 'loan';
        else if (prefix === 'C') serviceType = 'card';
        else serviceType = 'general';
        
        const position = queues[serviceType].indexOf(currentToken);
        if (position === -1) {
            // Check if token is currently being served
            for (const counterNum in counters) {
                if (counters[counterNum].current === currentToken) {
                    return `Your token ${currentToken} is currently being served at Counter ${counterNum} with ${counters[counterNum].staff}! Please proceed to the counter.`;
                }
            }
            return "I couldn't find your token in the queue. It may have already been served.";
        }
        
        const waitTime = (position + 1) * 5;
        const serviceName = serviceType === 'account' ? 'Account Services' :
                          serviceType === 'loan' ? 'Loan Applications' :
                          serviceType === 'card' ? 'Card Services' : 'General Inquiry';
        
        let response = `Hello ${currentCustomerName || 'there'}, here's your queue status:\n\n`;
        response += `- Token: ${currentToken}\n`;
        response += `- Service: ${serviceName}\n`;
        response += `- Position in queue: ${position + 1}\n`;
        response += `- Estimated wait time: ${waitTime} minutes\n\n`;
        
        // Add counter information
        response += `Current counters serving ${serviceName}:\n`;
        let countersServing = false;
        for (const counterNum in counters) {
            if (counters[counterNum].service === serviceType && !counters[counterNum].paused) {
                response += `- Counter ${counterNum} (${counters[counterNum].staff}): Serving ${counters[counterNum].current || 'none'}\n`;
                countersServing = true;
            }
        }
        
        if (!countersServing) {
            response += `- No counters currently serving ${serviceName}`;
        }
        
        return response;
    }
    
    // Check for counter inquiries
    const counterMatch = lowerMsg.match(/counter (\d)/);
    if (counterMatch) {
        const counterNum = counterMatch[1];
        if (counters[counterNum]) {
            const counter = counters[counterNum];
            const status = counter.paused ? ' (PAUSED)' : '';
            const serviceName = counter.service === 'account' ? 'Account Services' :
                              counter.service === 'loan' ? 'Loan Applications' :
                              counter.service === 'card' ? 'Card Services' : 'General Inquiry';
            
            return `Counter ${counterNum} Details${status}:\n\n` +
                   `- Currently serving: ${counter.current || 'None'}\n` +
                   `- Service type: ${serviceName}\n` +
                   `- Staff: ${counter.staff}\n` +
                   `- Status: ${counter.paused ? 'Paused' : 'Active'}`;
        }
        return `I couldn't find information about Counter ${counterNum}.`;
    }
    
    // Check for all counters status
    if (/counters|all counters|status of counters/.test(lowerMsg)) {
        let response = "Current Status of All Counters:\n\n";
        for (const counterNum in counters) {
            const counter = counters[counterNum];
            const status = counter.paused ? ' (PAUSED)' : '';
            const serviceName = counter.service === 'account' ? 'Account Services' :
                              counter.service === 'loan' ? 'Loan Applications' :
                              counter.service === 'card' ? 'Card Services' : 'General Inquiry';
            
            response += `Counter ${counterNum}${status}:\n` +
                        `- Serving: ${counter.current || 'None'}\n` +
                        `- Service: ${serviceName}\n` +
                        `- Staff: ${counter.staff}\n\n`;
        }
        return response;
    }
    
    // Check for service types
    if (/account|loan|card|general/.test(lowerMsg)) {
        let serviceType = '';
        if (lowerMsg.includes('account')) serviceType = 'account';
        else if (lowerMsg.includes('loan')) serviceType = 'loan';
        else if (lowerMsg.includes('card')) serviceType = 'card';
        else if (lowerMsg.includes('general')) serviceType = 'general';
        
        if (serviceType) {
            const count = queues[serviceType].length;
            const serviceName = serviceType === 'account' ? 'Account Services' :
                              serviceType === 'loan' ? 'Loan Applications' :
                              serviceType === 'card' ? 'Card Services' : 'General Inquiry';
            
            let response = `Current Status for ${serviceName}:\n\n`;
            response += `- Customers waiting: ${count}\n`;
            response += `- Estimated wait time: ${count * 5} minutes\n\n`;
            
            // Add counters serving this service
            response += `Counters serving ${serviceName}:\n`;
            let countersServing = false;
            for (const counterNum in counters) {
                if (counters[counterNum].service === serviceType && !counters[counterNum].paused) {
                    response += `- Counter ${counterNum} (${counters[counterNum].staff}): Serving ${counters[counterNum].current || 'none'}\n`;
                    countersServing = true;
                }
            }
            
            if (!countersServing) {
                response += `- No counters currently serving ${serviceName}`;
            }
            
            return response;
        }
    }
    
    // Check for customer name
    if (/my name|who am i|customer name/.test(lowerMsg)) {
        if (currentCustomerName) {
            return `Our records show your name as ${currentCustomerName}. Is this correct?`;
        }
        return "I don't have your name on record. Did you enter your name when generating your token?";
    }
    
    // Jokes
    if (/joke|funny|make me laugh/.test(lowerMsg)) {
        const jokes = [
            "Why don't scientists trust atoms? Because they make up everything!",
            "Did you hear about the mathematician who's afraid of negative numbers? He'll stop at nothing to avoid them!",
            "Why don't queues ever get angry? Because they know how to wait their turn!",
            "What do you call a fake noodle? An impasta!",
            "How does a penguin build its house? Igloos it together!",
            "Why did the scarecrow win an award? Because he was outstanding in his field!",
            "What do you call a bear with no teeth? A gummy bear!",
            "Why can't you explain puns to kleptomaniacs? They always take things literally!",
            "What's orange and sounds like a parrot? A carrot!",
            "Why did the golfer bring two pairs of pants? In case he got a hole in one!"
        ];
        return jokes[Math.floor(Math.random() * jokes.length)];
    }
    
    // General knowledge
    if (/general knowledge|quiz|trivia|tell me something/.test(lowerMsg)) {
        const facts = [
            "The Great Wall of China is the longest man-made structure in the world, stretching over 13,000 miles.",
            "The human body has enough fat to make seven bars of soap.",
            "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly good to eat.",
            "A crocodile cannot stick its tongue out.",
            "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
            "The dot over the letter 'i' is called a tittle.",
            "A group of flamingos is called a flamboyance.",
            "The inventor of the frisbee was turned into a frisbee after he died.",
            "The unicorn is the national animal of Scotland.",
            "There are more possible iterations of a game of chess than there are atoms in the known universe."
        ];
        return "Here's an interesting fact:\n\n" + facts[Math.floor(Math.random() * facts.length)];
    }
    
    // Time passing activities
    if (/bored|time pass|entertain me|what to do/.test(lowerMsg)) {
        const activities = [
            "Try counting backwards from 100 by 7s!",
            "Let's play a word game - name a country for every letter of the alphabet!",
            "Think of 5 things you can see, 4 you can touch, 3 you can hear, 2 you can smell, and 1 you can taste.",
            "Try to name all the US states (or your country's provinces) in 1 minute!",
            "Let's play 20 questions - think of an object and I'll try to guess it!",
            "Try to list all the movies you've watched this year.",
            "Let's play a rhyming game - I'll say a word and you say a word that rhymes!",
            "Try to solve this riddle: What has keys but can't open locks, has space but no room, and you can enter but not go in? (Answer: A keyboard)",
            "Let's play 'Would You Rather' - Would you rather be able to fly or be invisible?",
            "Try to name all the planets in our solar system in order from the sun."
        ];
        return "While you wait, here's an activity to pass the time:\n\n" + 
               activities[Math.floor(Math.random() * activities.length)];
    }
    
    // Help command
    if (/help|what can you do|options/.test(lowerMsg)) {
        return "I can help you with:\n\n" +
               "**Queue Information:**\n" +
               "- Check your position in the queue\n" +
               "- Get estimated wait times\n" +
               "- View counter statuses\n" +
               "- Check which service each counter is handling\n\n" +
               "**Entertainment:**\n" +
               "- Tell you a joke\n" +
               "- Share interesting facts\n" +
               "- Suggest activities to pass time\n\n" +
               "**General Information:**\n" +
               "- Tell you the current time\n" +
               "- Confirm your customer details\n" +
               "- Answer general knowledge questions\n\n" +
               "Just ask me anything related to these topics!";
    }
    
    // Default response
    return "I can help you with:\n" +
           "- Your queue position and wait time\n" +
           "- Current counter status and staff information\n" +
           "- Service types and their queue lengths\n" +
           "- Fun activities to pass time while waiting\n\n" +
           "You can also ask for the time, a joke, or general knowledge facts! " +
           "Type 'help' to see all options.";
}
    </script>

</body>
</html>